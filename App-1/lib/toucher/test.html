<!doctype html>
<html>
<head>
<meta charset="utf-8">

<meta name="apple-touch-fullscreen" content="yes">
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="KOK">

<title> HTML 5 Game UI Template</title>

<style type="text/css">

* {
    -webkit-text-size-adjust:none;
}
body, div {
    -webkit-text-size-adjust:none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    -webkit-touch-callout: none;
}

/* for dev */
html,body {
    padding : 0;
    margin : 0;
    height : 100%;
}
#container {
    background-color: #a1bb39 !important;
    visibility :visible;
    top : 0px;
    left : 0px;
}




#log {
    position: absolute;
    top : 5px;
    left : 5px;
    min-width : 200px;
    min-height : 100px;
    z-index:999;
    border : 1px solid black;
    display: block;
}

</style>


<script src="../Base.js"></script>
<script src="../DomBase.js"></script>
<script src="../Slider.js"></script>

<script src="../toucher/Controller.js"></script>
<script src="../toucher/TouchWrapper.js"></script>
<script src="../toucher/Listener.js"></script>
<script src="../toucher/gesture/Any.js"></script>
<script src="../toucher/gesture/Tap.js"></script>
<script src="../toucher/gesture/Pan.js"></script>
<script src="../toucher/gesture/Swipe.js"></script>
<script src="../toucher/gesture/Scale.js"></script>

<script src="../toucher/components/Joystick.js"></script>

<script src="../toucher/test.js"></script>



<script>



/* for dev */
window.addEventListener("load",function(){
    document.body.addEventListener("touchstart",function(){});
    document.body.addEventListener("touchcancel",function(){
        // event.preventDefault();
        document.title="touchcancel"
    },true);

	document.body.addEventListener("touchmove",function(){
		event.preventDefault();
	},false);
    document.body.addEventListener("gesturestart",function(){
        event.preventDefault();
    },true);
 

    initContainer(Config.width,Config.height);

    initTouchController();
    initTouchListener();

    initJoystick();

    start();
});
calcWindowSize();



var container,canvas,context;
var logBox;

function initContainer (width, height){
    logBox=$id("log");

    container=$id("container");
    
    canvas=$id("canvas");
    canvas.width=width;
    canvas.height=height;
    context=canvas.getContext("2d");

    if (container){
        merger(container.style,{
            visibility : "visible",
            position : "relative" ,
            overflow : "hidden" ,       
            padding : "0px" ,
            opacity : "1" ,
            width : width+"px" ,
            height : height+"px",
            // marginLeft : -width/2+"px",
            // left : "50%"
        });             
    }       
}



var Config={
    width : 960,
    height : 640
}
var Logs=[];
function addLog(msg){
    msg=Array.prototype.join.call(arguments,", ");
    Logs.unshift(msg);
    if (Logs.length>4){
        Logs.length=4;
    }
}

var Points={}

var rectSide=100;
function start(){

    context.strokeStyle="black";
    context.lineWidth=2;

    setInterval(function(){
        context.clearRect(0,0,Config.width,Config.height)

        for (var key in Points){
            var p=Points[key];
            context.strokeRect(p[0]-rectSide/2,p[1]-rectSide/2,rectSide,rectSide);
        }
        var touched=controller.touched;
        var touchA=false,touchB=false;
        for (var id in touched){
            var touchWrapper=touched[id];
            var e=document.elementFromPoint(touchWrapper.clientX,touchWrapper.clientY);
            if (e && e.classList.contains("padButton")){
                // touchA=true;
                if (e==buttonA){
                    touchA=true;
                }else if (e==buttonB){
                    touchB=true;
                }
                // break;
            }
        }
  
        if (touchA){
            buttonA.classList.add("padButtonDown");
        }else{
            buttonA.classList.remove("padButtonDown");
        }
        if (touchB){
            buttonB.classList.add("padButtonDown");
        }else{
            buttonB.classList.remove("padButtonDown");
        }


        logBox.innerHTML=controller.touchedCount+"<br>"+Logs.join("<br>");

    },1000/60);

}


</script>

<style type="text/css">


/*.joystick {
    position: absolute;
    top : 80px;
    left : 120px;
}
*/
.slot {
position: absolute;
background-color : #dddddd;
border : 1px solid #333333;
opacity: 0.3;
display: none;
}

.stick {
position: absolute;
background-color : #336699;
}

.padButton {
    position: absolute;
    right : 50px;
    bottom : 100px;
    background-color : #cccccc;
    opacity: 0.3;
    width : 100px;
    height : 100px;
    border-radius: 50px;
}
.padButtonDown {
    opacity: 1;
}
#buttonB {
    background-color : #cc0000; 
    right : 180px;
    /*width : 150px;*/
    /*height : 150px;*/
    /*border-radius: 80px;*/
    /*z-index:100000;*/
    /*bottom : 120px;*/
}
</style>

</head>

<body>
<div id="container" class="game-container">

<canvas id="canvas" ></canvas>
<div id="log" ></div>



    <div id="slot1" class="slot">
        <div id="stick1" class="stick">

        </div>
    </div>
    <div id="buttonA" class="padButton"></div>
    <div id="buttonB" class="padButton"></div>
    <!-- <div id="buttonB" class="padButton"></div> -->


</div>

</body>
</html>
